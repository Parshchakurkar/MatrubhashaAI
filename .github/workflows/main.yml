name: Sync to Azure DevOps
on:
  push:
    branches: [ main ]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Configure Git
        run: |
          git config user.name "GitHub Sync Bot"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Add Azure DevOps remote
        env:
          ADO_PAT: ${{ secrets.ADO_PAT }}
        run: |
          # Use username: PAT for auth; username can be anything non-empty, e.g., 'pat'
          git remote remove azure 2>/dev/null || true
          git remote add azure "https://pat:${ADO_PAT}@dev.azure.com/parshchakurkar/MatrubhashaAI/_git/MatrubhashaAI"

      - name: Push main to Azure DevOps
        run: |
          # Ensure main exists locally (in case default branch is master)
          git show-ref --verify --quiet refs/heads/main || { echo "Branch 'main' not found locally"; exit 1; }
          git pull azure main  
          git push --force-with-lease azure main:main

